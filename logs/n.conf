 server {

       listen 80 ;
       listen [::]:80;


#        listen       somename:8080;
        server_name  kommersant1;
        root   /var/www/kommersant;

#       location ~ ^(.*)$ {
#           index  index.html index.htm;
#          try_files $uri $uri/ @index;
#       }

         location / {
#         rewrite ^ /index.html break;
                proxy_pass   http://0.0.0.0:3333;
                 proxy_cache STATIC;
                 proxy_cache_valid      200  20s;
                 proxy_cache_use_stale  error timeout invalid_header updating
                                    http_500 http_502 http_503 http_504;
#                proxy_redirect off;

     }
     ##
             #  Redirect to ssl
             ##

#      location / {
#              rewrite ^(.*)$ https://$host$1 redirect;
#      }

#         location @index {
# #               rewrite ^ /index.html break;
#                 proxy_pass   http://0.0.0.0:3333;
#                 proxy_cache STATIC;
#         proxy_cache_valid      200  10s;
#     }

#         location /3078 {
#                 proxy_pass   http://0.0.0.0:3078;
#     }
}
#

server {

        listen *:443 ssl http2;
        server_name kommersant1ssh;
        #PLACE_ssl_certificate
        #PLACE_ssl_certificate_key
        #PLACE_ssl_trusted_certificate
        root   /var/www/kommersant;

        ssl_certificate      /home/proton/kommersant_ru.crt;
        ssl_certificate_key  /home/proton/kommersant_ru.key;

        ##
        #  Proxy pass
        ##

          location / {
         #         rewrite ^ /index.html break;
             proxy_pass   http://0.0.0.0:3333;
             proxy_cache STATIC;
             proxy_cache_valid      200  20s;
             proxy_cache_use_stale  error timeout invalid_header updating
                                 http_500 http_502 http_503 http_504;
             proxy_redirect off;

          }
}

 server {

       listen 8080 ;
       listen [::]:8080;


#        listen       somename:8080;
        server_name  kommersant1loadbalancing;
        root   /var/www/kommersant;

#       location ~ ^(.*)$ {
#           index  index.html index.htm;
#          try_files $uri $uri/ @index;
#       }

         location / {
#         rewrite ^ /index.html break;
                proxy_pass   http://front;
#                  proxy_cache STATIC;
#                  proxy_cache_valid      200  20s;
#                  proxy_cache_use_stale  error timeout invalid_header updating
#                                     http_500 http_502 http_503 http_504;
#                proxy_redirect off;

     }
     ##
             #  Redirect to ssl
             ##

#      location / {
#              rewrite ^(.*)$ https://$host$1 redirect;
#      }

#         location @index {
# #               rewrite ^ /index.html break;
#                 proxy_pass   http://0.0.0.0:3333;
#                 proxy_cache STATIC;
#         proxy_cache_valid      200  10s;
#     }

#         location /3078 {
#                 proxy_pass   http://0.0.0.0:3078;
#     }
}

upstream front {
    server 172.27.12.187:3333 weight=5;
    server 172.27.12.188:3333 weight=5;

}
